<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Putting up a Rancher Kubernetes Cluster on Bare Metal | Greg Grubbs | Hype Cyclist</title>

<meta property='og:title' content='Putting up a Rancher Kubernetes Cluster on Bare Metal - Greg Grubbs | Hype Cyclist'>
<meta property='og:description' content='short post description'>
<meta property='og:url' content='https://hypecyclist.org/post/2020-06-19-putting-up-a-rancher-kubernetes-cluster-on-bare-metal/'>
<meta property='og:site_name' content='Greg Grubbs | Hype Cyclist'>
<meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='homelab'><meta property='article:tag' content='kubernetes'><meta property='article:tag' content='docker'><meta property='article:tag' content='rancher'><meta property='article:tag' content='howto'><meta property='article:published_time' content='2020-06-19T17:56:14-06:00'><meta property='article:modified_time' content='2020-06-19T17:56:14-06:00'><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@gregoryg'><meta name='twitter:creator' content='@gregoryg'>


<link href="https://hypecyclist.org/index.xml" rel="alternate" type="application/rss+xml" title="Greg Grubbs | Hype Cyclist" />

<link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://hypecyclist.org/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="https://hypecyclist.org/post/2020-06-19-putting-up-a-rancher-kubernetes-cluster-on-bare-metal/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
 
<body>

<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://hypecyclist.org">
          <h1 id="nav-heading" class="title is-4">Greg Grubbs | Hype Cyclist</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/gregoryg'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg>
</i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/gregorygrubbs'
            target='_blank' rel='me noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg>
</i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
      <div class="nav-right"><a class="nav-item" href="/about">
          <h2 class="title is-5">About</h2>
        </a><a class="nav-item" href="/post">
          <h2 class="title is-5">Blog</h2>
        </a></div>
      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/homelab/">#homelab</a>



  
  | <a class="subtitle is-6" href="/tags/kubernetes/">#kubernetes</a>
  
  | <a class="subtitle is-6" href="/tags/docker/">#docker</a>
  
  | <a class="subtitle is-6" href="/tags/rancher/">#rancher</a>
  
  | <a class="subtitle is-6" href="/tags/howto/">#howto</a>
  


      
    </div>
    
    <h2 class="subtitle is-6">June 19, 2020</h2>
    
    <h1 class="title">Putting up a Rancher Kubernetes Cluster on Bare Metal</h1>
    
    <div class="content">
      <img src="/images/ioan-roman-6zwcmtwHr3I-unsplash.jpg" alt="Inline Non-hyperlinked Image" title="bare metal"/>
<p>When it comes time to set up a multi-node cluster on bare metal servers, it doesn&#39;t get
easier than <a href="https://rancher.com/docs/rke/latest/en/">Rancher&#39;s RKE</a>.  Here&#39;s a quick guide for standing up your first development
cluster.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Set up your servers
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>Do the usual prep for cluster software: same user, same SSH key accepted for that user,
  passwordless SUDO etc.  Install Docker on the nodes.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Download the Command Line tool
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>Grab the <code class="verbatim">rke</code> CLI for your OS from the <a href="https://github.com/rancher/rke/releases">releases page</a></p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Set up the initial RKE cluster
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>Have a look at some starter configs and adjust as necessary:</p>
<ul>
<li><a href="https://rancher.com/docs/rke/latest/en/example-yamls/#minimal-cluster-yml-example">Cluster minimal example config</a> (single node)</li>
<li>My <a href="https://raw.githubusercontent.com/gregoryg/hypecyclist/master/content/code/cluster.yaml">simple config</a> (multi-node non-HA)</li>
</ul>
<p>Once you have the config to your liking, run</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  <span style="color:#080;font-style:italic"># rke up</span>
</span></span><span style="display:flex;"><span>  rke up --config cluster.yaml --ssh-agent-auth
</span></span><span style="display:flex;"><span>  <span style="color:#b8860b">KUBECONFIG</span><span style="color:#666">=</span>kube_config_cluster.yaml kubectl get nodes</span></span></code></pre></div>
</div>
<p>
   You get to skip setting up Pod Networking for RKE - Canal is already installed and configured</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Set up Load Balancing
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>On our bare metal cluster, we&#39;ll use MetalLB - be sure to check <a href="https://github.com/metallb/metallb/releases">releases</a> to get the
  right URL</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  <span style="color:#080;font-style:italic"># use new namespace metallb-system</span>
</span></span><span style="display:flex;"><span>  kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml
</span></span><span style="display:flex;"><span>  kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-style:italic"># On first install only</span>
</span></span><span style="display:flex;"><span>  kubectl create secret generic -n metallb-system memberlist --from-literal<span style="color:#666">=</span><span style="color:#b8860b">secretkey</span><span style="color:#666">=</span><span style="color:#b44">&#34;</span><span style="color:#a2f;font-weight:bold">$(</span>openssl rand -base64 128<span style="color:#a2f;font-weight:bold">)</span><span style="color:#b44">&#34;</span></span></span></code></pre></div>
</div>
<p>Give MetalLB a pool of IP addresses</p>
<ul>
<li>
<p>Here I&#39;m using a pool from the cluster&#39;s network</p>
<div class="src src-yaml">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>v1<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>ConfigMap<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">namespace</span>:<span style="color:#bbb"> </span>metallb-system<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>config<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">data</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">config</span>:<span style="color:#bbb"> </span>|<span style="color:#b44;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#b44;font-style:italic">      address-pools:
</span></span></span><span style="display:flex;"><span><span style="color:#b44;font-style:italic">      - name: default
</span></span></span><span style="display:flex;"><span><span style="color:#b44;font-style:italic">        protocol: layer2
</span></span></span><span style="display:flex;"><span><span style="color:#b44;font-style:italic">        addresses:
</span></span></span><span style="display:flex;"><span><span style="color:#b44;font-style:italic">        - 172.16.27.230-172.16.27.250</span><span style="color:#bbb">      </span></span></span></code></pre></div>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
Install Rancher on the cluster
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>We&#39;re going to install a cluster manager … on the cluster being managed.</p>
<p>
    There are several options for getting a Web UI overview of either a single cluster or
    multiple clusters.  These will usually offer the ability to display resource usage,
    view and edit running resources, and create new resources.  Some allow higher level
    options like setting workloads to run on multiple clusters, deploying secrets and
    config maps across clusters, etc.</p>
<p>
    A great choice for this is <a href="https://rancher.com/docs/rancher/v2.x/en/">Rancher</a> (not <a href="https://rancher.com/docs/rke/latest/en/">RKE</a> or <a href="https://rancher.com/docs/k3s/latest/en/">K3s</a>, which are Kubernetes distributions
    offered by <a href="https://rancher.com/">Rancher Labs</a>).  All you have to do to get started is to follow the guide at
    <a href="https://rancher.com/docs/rancher/v2.x/en/quick-start-guide/deployment/quickstart-manual-setup/">Rancher Docs: Manual Quick Start</a></p>
<p>
    Rancher gives us a great UI for management of this cluster and any other clusters we
    may want to manage in the future (RKE or not)</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  kubectl create ns cattle-system
</span></span><span style="display:flex;"><span>  helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
</span></span><span style="display:flex;"><span>  helm install rancher rancher-latest/rancher <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>       --namespace cattle-system <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>       --set <span style="color:#b8860b">hostname</span><span style="color:#666">=</span>rancher.local</span></span></code></pre></div>
</div>
<p>
    I find that the Helm chart <code class="verbatim">rancher-2.4.4</code> exposes port 80 but does not expose
    port 443.  So I needed to expose that before I could run Rancher UI in a browser.</p>
<p>
    I edited the <code class="verbatim">rancher</code> Service to expose the SSL port under <code class="verbatim">spec.ports</code></p>
<div class="src src-yaml">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>https<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">port</span>:<span style="color:#bbb"> </span><span style="color:#666">443</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">protocol</span>:<span style="color:#bbb"> </span>TCP<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">targetPort</span>:<span style="color:#bbb"> </span><span style="color:#666">443</span></span></span></code></pre></div>
</div>
<p>
    If you should ever need to reset the Rancher admin user password</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  kubectl  <span style="color:#a2f">exec</span> -n cattle-system <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           <span style="color:#a2f;font-weight:bold">$(</span>kubectl get pods -n cattle-system -o json | jq -r <span style="color:#b44">&#39;.items[] | select(.spec.containers[].name==&#34;rancher&#34;) | .metadata.name&#39;</span><span style="color:#a2f;font-weight:bold">)</span> -- reset-password</span></span></code></pre></div>
</div>
<p>
    After all that hoohaw, I should mention that you can also simply run Rancher from a
    Docker container - and use that to manage multiple clusters.</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  <span style="color:#080;font-style:italic"># Run Rancher on all network interfaces</span>
</span></span><span style="display:flex;"><span>  docker run --name rancher -d --restart<span style="color:#666">=</span>unless-stopped -p 0.0.0.0:80:80 -p 0.0.0.0:443:443 rancher/rancher
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-style:italic"># Reset password when needed</span>
</span></span><span style="display:flex;"><span>  <span style="color:#080;font-style:italic"># docker exec -ti &lt;container_id&gt; reset-password</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
Set up an ingress controller
</h2>
<div id="outline-text-headline-6" class="outline-text-2">
<p>I used Traefik, installed using the handy Rancher catalog</p>
<p>
  Set parameters:</p>
<pre class="example">
Service Type: NodePort
SSL: True
Force HTTP to HTTPS
Enable Dashbord - domain traefik.local
</pre>
<p>
  Once deployed, enable load balancer access to the Traefik UI (or create an Ingress, of course)</p>
<p>
  <code class="verbatim">kubectl -n traefik edit svc traefik-dashboard</code></p>
<ul>
<li>Change to <code class="verbatim">LoadBalancer</code></li>
</ul>
<p>An example of creating an Ingress.  This is to get into the Longhorn UI</p>
<div class="src src-yaml">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">apiVersion</span>:<span style="color:#bbb"> </span>extensions/v1beta1<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">kind</span>:<span style="color:#bbb"> </span>Ingress<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">metadata</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">namespace</span>:<span style="color:#bbb"> </span>longhorn-system<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">labels</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">app</span>:<span style="color:#bbb"> </span>longhorn-frontend<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>longhorn-ui<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">spec</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">rules</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>- <span style="color:#008000;font-weight:bold">host</span>:<span style="color:#bbb"> </span>longhorn-frontend.example.com<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">http</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#008000;font-weight:bold">paths</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#008000;font-weight:bold">backend</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">serviceName</span>:<span style="color:#bbb"> </span>longhorn-frontend<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">servicePort</span>:<span style="color:#bbb"> </span>http</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-7" class="outline-2">
<h2 id="headline-7">
Establish a storage solution
</h2>
<div id="outline-text-headline-7" class="outline-text-2">
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Longhorn
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<p>Longhorn is an open source project created by Rancher Labs</p>
<p>
   I love this solution because it&#39; so easy to use in my homelab setting: just point it to
   any unused already-formatted disk on each of your nodes.  Longhorn will manage all that
   space in a pool, and automatically create replication sets of any persistent volumes
   you create.</p>
<div id="outline-container-headline-9" class="outline-4">
<h4 id="headline-9">
Install prerequisite: <code class="verbatim">open-iscsi</code>
</h4>
<div id="outline-text-headline-9" class="outline-text-4">
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  sudo apt-get -y install open-iscsi</span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-10" class="outline-4">
<h4 id="headline-10">
Install Longhorn
</h4>
<div id="outline-text-headline-10" class="outline-text-4">
<p>Since we have Rancher installed now, you can use the app catalog feature to do this.
   Simply create a project - I called mine <code class="verbatim">Storage</code>.  Then add a newly created
   <code class="verbatim">longhorn-system</code> namespace to that project.  Then select the Longhorn app from the
   catalog and install!</p>
<p>
   Alternatively you can install using <code class="verbatim">kubectl</code>:</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  kubectl apply -f  https://raw.githubusercontent.com/longhorn/longhorn/master/deploy/longhorn.yaml</span></span></code></pre></div>
</div>
<p>
   If you want to create easy access to the Longhorn UI, change the <code class="verbatim">longhorn-frontend</code>
   service to either NodePort or LoadBalancer.  If the latter, you will need to implement
   a load balancer solution such as MetalLB (see below)</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-11" class="outline-3">
<h3 id="headline-11">
Optionally make one storage class the default
</h3>
<div id="outline-text-headline-11" class="outline-text-3">
<p>Add annotation to the desired StorageClass resource</p>
<div class="src src-yaml">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">annotations</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">storageclass.kubernetes.io/is-default-class</span>:<span style="color:#bbb"> </span><span style="color:#b44">&#34;true&#34;</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>Check with <code class="verbatim">kubectl get sc</code></p>
<pre class="example">
  NAME                 PROVISIONER          RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
  longhorn (default)   driver.longhorn.io   Delete          Immediate           true                   21m
</pre>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-12" class="outline-2">
<h2 id="headline-12">
Tear down your cluster when the time comes
</h2>
<div id="outline-text-headline-12" class="outline-text-2">
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  rke remove --config cluster.yaml --ssh-agent-auth</span></span></code></pre></div>
</div>
<div id="outline-container-headline-13" class="outline-3">
<h3 id="headline-13">
Cleanup after removal of any distribution
</h3>
<div id="outline-text-headline-13" class="outline-text-3">
<p>Some components may need manual removal</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  sudo rm -rf /var/lib/longhorn /etc/cni/net.d/ /etc/kubernetes /data/longhorn/*</span></span></code></pre></div>
</div>
<p>
   Optionally assure that all the Docker containers are retired</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  docker stop <span style="color:#b44">`</span>docker ps -a -q<span style="color:#b44">`</span>
</span></span><span style="display:flex;"><span>  docker rm <span style="color:#b44">`</span>docker ps -a -q<span style="color:#b44">`</span></span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
      
    </div>
    
  </div>
</section>

    <script src="/js/copycode.js"></script>


<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
  
    <script type="text/javascript">
      var disqus_shortname = 'hypecyclist';
      function disqus() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }
  
      disqus();
  

    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>





<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/gregoryg">Greg Grubbs</a> 2008-2021</p>
    
      <p id="powered-by">Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>

<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="\/\/matomo.example.com\/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript>
  <img src="//matomo.example.com/piwik.php?idsite=1&amp;rec=1" style="border:0" alt="">
</noscript>

<script>
    (function(f, a, t, h, o, m){
        a[h]=a[h]||function(){
            (a[h].q=a[h].q||[]).push(arguments)
        };
        o=f.createElement('script'),
        m=f.getElementsByTagName('script')[0];
        o.async=1; o.src=t; o.id='fathom-script';
        m.parentNode.insertBefore(o,m)
    })(document, window, '\/\/fathom.example.com\/tracker.js', 'fathom');
    fathom('trackPageview');
</script>


</body>
</html>

